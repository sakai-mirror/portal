##
##        rcontext.put("loggedIn",Boolean.value(session.getUserId() != null));
##
##                    m.put("isPage",Boolean.valueOf(true));
##                    m.put("current", Boolean.valueOf(current));
##                    m.put("ispopup", Boolean.valueOf(p.isPopUp()));
##                    m.put("pagePopupUrl", pagePopupUrl);
##                    m.put("pageTitle", Web.escapeHtml(p.getTitle()));
##                    m.put("jsPageTitle", Web.escapeJavascript(p.getTitle()));
##                    m.put("pageId", Web.escapeUrl(p.getId()));
##                    m.put("jsPageId", Web.escapeJavascript(p.getId()));
##                    m.put("pagerefUrl", pagerefUrl);
##
##                    m.put("isPage",Boolean.valueOf(false));
##                    m.put("toolId", Web.escapeUrl(placement.getId()));
##                    m.put("jsToolId", Web.escapeJavascript(placement.getId()));
##                    m.put("toolTitle", Web.escapeHtml(placement.getTitle()));
##                    m.put("jsToolTitle", Web.escapeJavascript(placement.getTitle()));
##                    m.put("toolrefUrl", toolrefUrl);
##
#set ( $isPDA = 1 ) 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${pageSkinRepo}/${pageSkin}/portal.css" type="text/css" rel="stylesheet" media="all" />
<!-- this caises problems for layout nneds investihating -->
    <link href="/portal/styles/portalstyles.css" type="text/css" rel="stylesheet" media="all" />
<!--[if gte IE 5]><![if lt IE 7]>
    <link href="/portal/styles/portalstyles-ie5.css" type="text/css" rel="stylesheet" media="all" />
<![endif]><![endif]-->

    <meta http-equiv="Content-Style-Type" content="text/css" />
#if (! $currentPlacement && $isPDA )
    <meta name="viewport" content="width=320, user-scalable=no" />
#end
#if ( ${bufferedResponse} && ${responseHead} ) 
<!-- Head material from Tool (will include title and headscripts) -->
${responseHead}
<!-- End of Head material from Tool -->
	#if (  $pageColumn0Tools )
		#foreach ( $tool in $pageColumn0Tools ) 
			#if ( $tool ) 
				#if ( $tool.toolRenderResult ) 
${tool.toolRenderResult.getTitle()}
				#end
			#end
		#end
	#end
	#if ($pageTwoColumn)
		#if (  $pageColumn1Tools )
			#foreach ( $tool in $pageColumn1Tools ) 
				#if ( $tool ) 
					#if ( $tool.toolRenderResult ) 
${tool.toolRenderResult.getTitle()}
					#end
				#end
			#end
		#end
	#end
#else 
    <title>${pageTitle}</title>
     <script type="text/javascript" language="JavaScript" src="${pageScriptPath}headscripts.js"></script>
     <script type="text/javascript" language="JavaScript" src="${pageScriptPath}jquery-1.1.2.js"></script>
#end
<script type="text/javascript" language="JavaScript" src="/portal/scripts/portalscripts.js"></script>

#if ( ${styleable} )
<script type="text/javascript" 
    	language="JavaScript" 
    	src="/sakai-preferable-tool/js/styleable.js" >
    </script>
    
    <script type="text/javascript" 
            language="JavaScript">
    window.onload = insertStyleAbleStyles;
    </script>
    #if ( ${styleableStyleSheet} )
	<style type="text/css" title="StyleAble">${styleableStyleSheet}</style>
    #end
    #if ( ${styleableJS} )
	<script type="text/javascript" language="JavaScript">
	${styleableJS} 
	</script>
    #end
#end
</head>
<body class="portalBody">
#if ( $pageTop )
	<script type="text/javascript" language="JavaScript">
	var sakaiPortalWindow = "";
	</script>
#end
<!-- END Header -->

<!-- pda.vm -->
#if ( ${wurflSmallDisplay} ) 
<!-- Mobile Device ${wurflDevice} -->
#end
## Always assume small display
#set ( $wurflSmallDisplay = 1 )
<div class="portlet">
  <div id="pda-portlet-menu">
  <a href="${portalTopUrl}" title="Back to Site List">Sites</a> 
#if ($currentSite)
  #if ( $currentSite.isChild )
    #foreach ( $site in $currentSite.pwd ) 
 	> <a href="${site.siteUrl}" title="${site.siteTitle}">
	<span>${site.siteTitle}</span>
	</a>
    #end
  #else
    > <a href="${currentSite.siteUrl}" title="${currentSite.siteTitle}">
    <span>${currentSite.siteTitle}</span>
    </a>
  #end
#end
#if ($currentPlacement)
  #if ( ${bufferedResponse} && ${responseBody} ) 
    > ${currentPlacement.toolTitle}
  #else
    > <a href="${currentPlacement.toolResetActionUrl}" target="${currentPlacement.toolPlacementIDJS}" 
    >${currentPlacement.toolTitle}</a>
  #end
#end
#if (${currentPlacement.toolShowHelpButton})
  #if (${currentPlacement.toolJSR168Help} )
    &nbsp;(<a accesskey="h" href="${currentPlacement.toolJSR168Help}" title="${rloader.sit_help}">?</a>)
  #else
    &nbsp;(<a accesskey="h" href="${currentPlacement.toolHelpActionUrl}" title="${rloader.sit_help}"
      target="_blank" onclick="openWindow('${currentPlacement.toolHelpActionUrl}', 'Help',
      'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); return false">?</a>)
  #end
#end
#if (${currentPlacement.toolJSR168Edit} )
  &nbsp;(<a accesskey="e" href="${currentPlacement.toolJSR168Edit}" title="${rloader.sit_edit}">*</a>)
#end
#if ( ${wurflSmallDisplay} ) 
  <!-- WURFL Small Display -->
  &nbsp; | &nbsp;
  #if ( $loggedIn ) 
    <a href="${portalTopUrl}?force.logout=yes">Log Out</a>
  #else
    <a href="${portalTopUrl}?force.login=yes">Log In</a>
  #end
  <!-- End WURFL Small Display -->
#else
  <div class="portletpresencebutton" >
  #if (${currentSite.sitePages.pageNavShowPresenceLoggedIn})
    #if ($currentSite)
      #if ( ! $currentSite.isMyWorkspace )
        <a href="#" onclick="hidePresence();" onmouseover="showPresence();" onmouseout="hidePresence();">Users Present</a> | 
      #end
    #end
  #end
  #if ( $loggedIn ) 
    <a href="${portalTopUrl}?force.logout=yes">Log Out</a>
  #else
    <a href="${portalTopUrl}?force.login=yes">Log In</a>
  #end
  </div>
#end
</div> <!--end of menu bar -->
#if ($currentPlacement)
  #if ( ${bufferedResponse} && ${responseBody} ) 
<!-- Buffered Body Tool Content -->
${responseBody}
<!-- End Buffered Body Tool Content -->
  #else
    <!-- start include Tool Body -->
	#if (${currentPlacement.hasRenderResult})
		<div class="portletMainWrap">
		    ${currentPlacement.toolRenderResult.getContent()}
		</div>
	#else
		<div class="portletMainWrap">
			<iframe	name="${currentPlacement.toolPlacementIDJS}" id="${currentPlacement.toolPlacementIDJS}" title="${currentPlacement.toolTitle}" 
				class ="portletMainIframe"
				height="50"
				width="100%"
				frameborder="0"
				marginwidth="0"
				marginheight="0"
				scrolling="auto"	
				src="${currentPlacement.toolUrl}?panel=Main">
			</iframe>
		</div>
	#end
    <!-- end include Tool Body -->
  #end
#else
  #if ($currentSite)
    <ul id="pda-portlet-page-menu"> 
    #foreach ( $page in $currentSite.sitePages.pageNavTools ) 
      #if ($page.isPage)
        ## This must be a popup - so we treat it as a popup
        <li>
          <a href="javascript:;" onclick="window.open('${page.pagePopupUrl}${page.pageId}','${page.jsPageTitle}','resizable=yes,toolbar=no,scrollbars=yes, width=800,height=600')">
            ${page.pageTitle}
        </a>
        </li>
      #else
        <li>
          <a href="${page.toolrefUrl}" title="${page.toolTitle}">${page.toolTitle}</a>
        </li>
      #end
    #end
    #if ( $subSites ) 
    	#foreach ( $site in $subSites ) 
          <li>
             <a href="${site.siteUrl}" title="${site.siteTitle}">
             <span>${site.siteTitle}</span>
             </a>
         </li>
       #end
    #end
    </ul>
  #else
    <ul id="pda-portlet-site-menu"> 
    #foreach ( $site in $allSites ) 
      <li>
      #if ( $site.isChild ) 
	#foreach ($i in [0..$site.depth] )
        	&nbsp;
	#end
      #end
        <a href="${site.siteUrl}" title="${site.siteTitle}">
          <span>${site.siteTitle}</span>
        </a>
      </li>
    #end 
    </ul>
  #end
#end
#if ($currentSite )
  #if ( ! ${wurflSmallDisplay} ) 
    #if (${currentSite.sitePages.pageNavShowPresenceLoggedIn})
	<script type="text/javascript" language="JavaScript">
	function showPresence()
	{
		window.document.getElementById('presdiv').style.position = 'absolute';
		window.document.getElementById('presdiv').style.top = '20px';
		window.document.getElementById('presdiv').style.right = '5px';
		window.document.getElementById('presdiv').style.left = 'auto';
	}

	function hidePresence()
	{
		window.document.getElementById('presdiv').style.position = 'absolute';
		window.document.getElementById('presdiv').style.top = '20px';
		window.document.getElementById('presdiv').style.right = 'auto';
		window.document.getElementById('presdiv').style.left = '-4000px';
	}
	</script>
	<div class="portletpresence" id="presdiv" >
		<div class="portletpresencewrapper" id="portletpresencewrapper">
			<iframe name="presenceIframe" id="presenceIframe" 
				frameborder="0" marginwidth="0" marginheight="0" scrolling="auto" 
				src="${currentSite.sitePages.pageNavPresenceUrl}" >
			</iframe>
		</div>
	</div>
    #end
  #end
#end
</div>
<!-- end pda.vm -->
	</body>
</html>