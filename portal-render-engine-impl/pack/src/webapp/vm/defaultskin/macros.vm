##
## emit the top of the page 
##
##------------------------------------------------------------------------------------------
#macro( start_response  )
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${pageSkinRepo}/${pageSkin}/portal.css" type="text/css" rel="stylesheet" media="all" />
<!-- this caises problems for layout nneds investihating -->
    <link href="/portal/styles/portalstyles.css" type="text/css" rel="stylesheet" media="all" />
<!--[if gte IE 5]><![if lt IE 7]>
    <link href="/portal/styles/portalstyles-ie5.css" type="text/css" rel="stylesheet" media="all" />
<![endif]><![endif]-->



    <meta http-equiv="Content-Style-Type" content="text/css" />
    <title>${pageTitle}</title>
    <script type="text/javascript" language="JavaScript" src="${pageScriptPath}headscripts.js"></script>
    
    
    
    
    <script type="text/javascript" language="JavaScript" src="/portal/scripts/portalscripts.js"></script>

#if ( ${styleable} )

<script type="text/javascript" 
    	language="JavaScript" 
    	src="/sakai-preferable-tool/js/styleable.js" >
    </script>
    
    <script type="text/javascript" 
            language="JavaScript">
    window.onload = insertStyleAbleStyles;
    </script>
    
#if ( ${styleableStyleSheet} )
	<style type="text/css" title="StyleAble">${styleableStyleSheet}</style>
#end

#if ( ${styleableJS} )
	<script type="text/javascript" language="JavaScript">
	${styleableJS} 
	</script>
#end

#end

</head>
<body class="portalBody">
<!--
<div class="skinselection" >
<form id="skinselect" action="#" method="GET" name="skinselect">
	<select name="portalskin" id="portalskin" onchange="skinselect.submit();" >
#foreach ($skin in $pageSkins) 
#if (  ${skin.name} == $pageCurrentSkin )
   		<option value="${skin.name}" selected="selected" >${skin.display}</option>
#else
   		<option value="${skin.name}" >${skin.display}</option>
#end
#end
	</select>
</form>
</div>
-->
#if ( $pageTop )
	<script type="text/javascript" language="JavaScript">
	var sakaiPortalWindow = "";
	</script>
#end
#end
##
## emit the bottom of the page
##
#macro( end_response  )
	</body>
</html>
#end
##------------------------------------------------------------------------------------------
##
## includeTool
##
##------------------------------------------------------------------------------------------
##		toolMap.put("toolUrl", toolUrl);
##		toolMap.put("toolPlacementIDJS", Web.escapeJavascript("Main"
##				+ placement.getId()));
##		toolMap.put("toolResetActionUrl", resetActionUrl);
##		toolMap.put("toolTitle", titleString);
##		toolMap.put("toolShowResetButton", Boolean.valueOf(showResetButton));
##		toolMap.put("toolShowHelpButton", Boolean.valueOf(showHelpButton));
##		toolMap.put("toolHelpActionUrl", helpActionUrl);
##


#macro( includeToolTitle $toolPlacement )
#if (${toolPlacement.hasRenderResult})
	<div class="portletTitleWrap">
		<div class="portletTitle">
			<div class="title">
#if (${toolPlacement.toolShowResetButton})
                <a href="${toolPlacement.toolResetActionUrl}" target="${toolPlacement.toolPlacementIDJS}" title="${rloader.sit_reset}">
                        <img src="/library/image/transparent.gif" alt="${rloader.sit_reset}" border="1" />
                </a>
#end
				<h2>${toolPlacement.toolRenderResult.getTitle()}</h2>
			</div>
			<div class="action">
#if (${toolPlacement.toolJSR168Edit} )
            <a accesskey="e" id="jsr-edit" href="${toolPlacement.toolJSR168Edit}" 
                   title="${rloader.sit_edit}"><img src="/library/image/transparent.gif"  
                    alt="${rloader.sit_edit}" border="0"></a>
#end 
#if (${toolPlacement.toolShowHelpButton})
	#if (${toolPlacement.toolJSR168Help} )
             <a accesskey="h" href="${toolPlacement.toolJSR168Help}" title="${rloader.sit_help}">
	#else
		<a accesskey="h" href="${toolPlacement.toolHelpActionUrl}" title="${rloader.sit_help}" 
		 target="_blank" onclick="openWindow('${toolPlacement.toolHelpActionUrl}', 'Help',
		  'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); return false">
	#end
			<img src="/library/image/transparent.gif"  alt="${rloader.sit_help}" border="0" />
		</a>
#end
			</div>
		</div>
	</div>
#else
	<div class="portletTitleWrap">
		<div class="portletTitle">
			<div class="title">
#if (${toolPlacement.toolShowResetButton})
                <a href="${toolPlacement.toolResetActionUrl} target="${toolPlacement.toolPlacementIDJS}" title="${sitReset}">
                        <img src="/library/image/transparent.gif" alt="${sitReset}" border="1" />
                </a>
#end	
				<h2>${toolPlacement.toolTitle}</h2>
			</div>
			<div class="action">
#if (${toolPlacement.toolShowHelpButton})
		<a accesskey="h" href="${toolPlacement.toolHelpActionUrl}" title="${rloader.sit_help}" 
		 target="_blank" onclick="openWindow('${toolPlacement.toolHelpActionUrl}', 'Help',
		  'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); return false">
			<img src="/library/image/transparent.gif"  alt="${rloader.sit_help}" border="0" />
		</a>
#end
			</div>
		</div>
	</div>
#end
#end

#macro( includeToolBody $toolPlacement )
#if (${toolPlacement.hasRenderResult})
	<div class="portletMainWrap">
	    ${toolPlacement.toolRenderResult.getContent()}
	</div>
#else
	<div class="portletMainWrap">
		<iframe	name="${toolPlacement.toolPlacementIDJS}" id="${toolPlacement.toolPlacementIDJS}" title="${toolPlacement.toolTitle}" 
			class ="portletMainIframe"
			height="50"
			width="100%"
			frameborder="0"
			marginwidth="0"
			marginheight="0"
			scrolling="auto"	
			src="${toolPlacement.toolUrl}?panel=Main">
		</iframe>
	</div>
#end
#end

#macro( includeTool $tool)
<div class="portlet">
#includeToolTitle( $tool )
#includeToolBody( $tool )
</div>
#end


##------------------------------------------------------------------------------------------
##
## includeLogo
##
##------------------------------------------------------------------------------------------
##		vcontext.put("logoSkin", skin);
##		vcontext.put("logoSkinRepo", skinRepo);
##		String siteType = calcSiteType(siteId);
##		String cssClass = (siteType != null) ? siteType
##				: "undeterminedSiteType";
##		vcontext.put("logoSiteType", siteType);
##		vcontext.put("logoSiteClass", cssClass);
##
#macro( includeLogo  ) 
<div id="siteNavWrapper" class="${logoSiteClass}">
	<div id="mastHead">
		<div id="mastLogo">
			<img title="Logo" alt="Logo" src="${logoSkinRepo}/${logoSkin}/images/logo_inst.gif" />
		</div>
		<div id="mastBanner">
			<img title="Banner" alt="Banner" src="${logoSkinRepo}/${logoSkin}/images/banner_inst.gif" />
		</div>
		<div id="mastLogin">
#includeLogin()
		</div>
	</div>
</div>
#end
##------------------------------------------------------------------------------------------
##
## includeLogin
##
##------------------------------------------------------------------------------------------	
##			vcontext.put("loginTopLogin", Boolean.valueOf(topLogin));
##			vcontext.put("loginLogInOutUrl", logInOutUrl);
##			vcontext.put("loginMessage", message);
##			vcontext.put("loginImage1", image1);
##			vcontext.put("loginLogInOutUrl2", logInOutUrl2);
##			vcontext.put("loginMessage2", message2);
##			vcontext.put("loginImage12", image2);
##			vcontext.put("loginPortalPath", ServerConfigurationService
##					.getString("portalPath"));
##			vcontext.put("loginEiWording", eidWording);
##			vcontext.put("loginPwWording", pwWording);
##			vcontext.put("loginWording", loginWording);
#macro( includeLogin  )
#if (!${loginTopLogin})
	<div id="loginLinks">
		<a href="${loginLogInOutUrl}" title="${loginMessage}">
#if (${loginHasImage1}) 
			<img src="${loginImage1}"/>
#else
			${loginMessage}
#end
		</a>
#if (${loginHasLogInOutUrl2})
		<a href="${loginLogInOutUrl2}" title="${loginMessage2}">
#if (${loginHasImage2}) 
			<img alt="${loginMessage2}" src="${loginImage2}"/>
#else
			${loginMessage2}
#end
		</a>
#end
	</div>
#else
	<form id="loginForm" method="post" action="${loginPortalPath}/xlogin" enctype="application/x-www-form-urlencoded">
		<label for="eid">${loginEidWording}</label>
		<input name="eid" id="eid" type="text" />
		<label for="pw">${loginPwWording}</label>
		<input name="pw" type="password" id="pw" />
		<input name="submit" type="submit" id="submit" value="${loginWording}" />
		<script type="text/javascript" language="JavaScript">
			document.forms[0].eid.focus();
		</script>
	</form>
#end
#end
##------------------------------------------------------------------------------------------
##
##includeTabs
##
##		rcontext.put("tabsCssClass",cssClass);
##			m.put("isCurrentSite",Boolean.valueOf(s.getId().equals(siteId)));
##			m.put("siteTitle",Web.escapeHtml(s.getTitle()));
##			m.put("siteUrl",Web.escapeHtml(s.getTitle()));
##		rcontext.put("tabsSites",l);		
##		rcontext.put("tabsHasExtraTitle",Boolean.valueOf(extraTitle != null));
##			rcontext.put("tabsExtraTitle",Web.escapeHtml(extraTitle));
##			
##				m.put("title",Web.escapeHtml(s.getTitle()));
##				m.put("url",siteUrl);
##			rcontext.put("tabsMoreSites",l);
##
##		rcontext.put("tabsAddLogout",Boolean.valueOf(addLogout));
##			rcontext.put("tabsLogoutUrl",logoutUrl);
##------------------------------------------------------------------------------------------
#macro( includeTabs  )
<!-- start includeTabs -->
<div class="${tabsCssClass}">
	<div id="siteNav">
		<div id="linkNav">
			<a id="sitetabs" class="skip" name="sitetabs"></a>
			<h1 class="skip">${rloader.sit_worksiteshead}</h1>
			<ul id="siteLinkList">
#foreach ( $site in $tabsSites ) 
#if (${site.isCurrentSite})
#if (${site.isMyWorkspace})
				<li class="selectedTab"><a href="#"><span>${rloader.sit_mywor}</span></a></li>
#else
				<li class="selectedTab"><a href="#"><span>${site.siteTitle}</span></a></li>
#end
#else
				<li><a href="${site.siteUrl}" title="${site.siteTitle} ${rloader.sit_mywor}">
#if (${site.isMyWorkspace})
					<span>${rloader.sit_mywor}</span>
#else
					<span>${site.siteTitle}</span>
#end
				</a></li>
#end
#end
				<li style="display:none;border-width:0" class="fixTabsIE">
					<a href="javascript:void(0);">#x20;</a>
				</li>
			</ul>
		</div>
#if ($tabsMoreSitesShow)
		<div id="selectNav">
			<span class="skip">${rloader.sit_selectmessage}</span>
			<select onchange="if (this.options[this.selectedIndex].value != '') { parent.location = this.options[this.selectedIndex].value; } else { this.selectedIndex = 0; }">
				<option value="" selected="selected">${rloader.sit_more}</option>
#foreach( $site in $tabsMoreSites )
				<option title="${site.siteTitle}" value="${site.siteUrl}">${site.siteTitle}</option> 
#end	
			</select>
		</div>
#end
#if ($tabsAddLogout)
		<div class="galleryLogin">
			<a href="$tabsLogoutUrl">${rloader.sit_log}</a>
		</div>
	</div>

#else
	</div>
	<div class="divColor" id="tabBottom">
	</div>
#end	
</div>
<!-- end includeTabs -->
#end
##------------------------------------------------------------------------------------------
##
## includeWorksite
##
##------------------------------------------------------------------------------------------
#macro( includeWorksite  ) 
#includePage()
#end
##------------------------------------------------------------------------------------------
## -- from includePageList ( doPage=true )
##------------------------------------------------------------------------------------------
##
##		rcontext.put("pageNavPublished",Boolean.valueOf(published));
##		rcontext.put("pageNavType",type);
##		rcontext.put("pageNavIconUrl",iconUrl);
##                    m.put("isPage",Boolean.valueOf(true));
##                    m.put("current", Boolean.valueOf(current));
##                    m.put("ispopup", Boolean.valueOf(p.isPopUp()));
##                    m.put("pagePopupUrl", pagePopupUrl);
##                    m.put("pageTitle", Web.escapeHtml(p.getTitle()));
##                    m.put("jsPageTitle", Web.escapeJavascript(p.getTitle()));
##                    m.put("pageId", Web.escapeUrl(p.getId()));
##                    m.put("jsPageId", Web.escapeJavascript(p.getId()));
##                    m.put("pageRefUrl", pageRefUrl);
##		rcontext.put("pageNavTools",l);		
##		rcontext.put("pageNavShowHelp",Boolean.valueOf(showHelp));
##		rcontext.put("pageNavHelpUrl",helpUrl);
##
##		rcontext.put("pageNavPresenceUrk",presenceUrl);
##		
#macro( includePageNav   )
<!-- start includePageNav -->
	<div class="divColor" id="toolMenuWrap">
		<div id="worksiteLogo">
#if (!${pageNavPublished})
			<p id="siteStatus">unpublished site</p>
#end
#if ($pageNavType && $pageNavType != "project" )
			<p id="siteType">$pageNavType</p>
#end
#if ($pageNavIconUrl && $pageNavIconUrl != "")
			<img src="$pageNavIconUrl" border="0" alt="Worksite Logo" />
#end
		</div>
		<a id="totoolmenu" class="skip" name="totoolmenu"></a>
		<h1 class="skip">${rloader.sit_toolshead}</h1>
		<div id="toolMenu">
			<ul>
#foreach( $page in $pageNavTools )
  #if (${page.current})
				<li class="selectedTool">
				<span>${page.pageTitle}</span>
				</li>
  #else
   #if (${page.ispopup})
				<li>
				<a href="javascript:;" onclick="window.open('${page.pagePopupUrl}${page.pageId}','${page.jsPageTitle}','resizable=yes,toolbar=no,scrollbars=yes, width=800,height=600')">
				<span>${page.pageTitle}</span>
				</a>
				</li>
   #else
			<li>
			<a href="${page.pageRefUrl}" ><span>${page.pageTitle}</span></a>
			</li>
   #end
  #end
#end
#if (${pageNavShowHelp})
				<li>
				<a  accesskey="6" href="${pageNavHelpUrl}" target="_blank" 
					onclick="openWindow('${pageNavHelpUrl}', 
					'Help', 'resizable=yes,toolbar=no,scrollbars=yes,menubar=yes,width=800,height=600'); 
					return false">
					<span>${rloader.sit_help}</span>
				</a>
				</li>
#end
			</ul>
		</div>
#if (${pageNavShowPresenceLoggedIn})
		<div id="presenceWrapper">
			<div id="presenceTitle">${rloader.sit_presencetitle}</div>
			<iframe name="presenceIframe" id="presenceIframe" title="${rloader.sit_presencetitle}"
				frameborder="0" marginwidth="0" marginheight="0" scrolling="auto" src="${pageNavPresenceUrl}" >
			</iframe>
		</div>
#end
	</div>
	<h1 class="skip">${rloader.sit_contentshead}</h1>
	<a id="tocontent" class="skip" name="tocontent"></a>
<!-- end includePageNav -->
#end		
##------------------------------------------------------------------------------------------
##
## from Include Page
## rcontext.put("pageWrapperClass", wrapperClass);
## rcontext.put("pageColumnLayout", Integer.valueOf(page.getLayout()));
## rcontext.put("pageColumn0Tools", toolList);
## rcontext.put("pageColumn1Tools", toolList);
##------------------------------------------------------------------------------------------
#macro( includePageBody ) 	
<!-- start includePageBody -->		
	<div id="$pageWrapperClass">
		<div id="$pageColumnLayout">
#foreach ( $tool in $pageColumn0Tools ) 
#if ( $tool ) 
#includeTool($tool)
#end
#end
		</div>
#if ($pageTwoColumn)
		<div id="col2of2">
#foreach ( $tool in $pageColumn1Tools ) 
#if ( $tool ) 
#includeTool($tool)
#end
#end
		</div>
#end
	</div>
	<div>
#includeBottom()
	</div>
<!-- end includePageBody -->
#end
##------------------------------------------------------------------------------------------
##
## from Include Page
## rcontext.put("pageWrapperClass", wrapperClass);
## rcontext.put("pageColumnLayout", Integer.valueOf(page.getLayout()));
## rcontext.put("pageColumn0Tools", toolList);
## rcontext.put("pageColumn1Tools", toolList);
##------------------------------------------------------------------------------------------
#macro( includePage ) 	
<!-- start includePage -->		
<div id="container" $pageSiteType >
#includePageNav()
#includePageBody()
</div>
<!-- end includePage -->		
#end
##------------------------------------------------------------------------------------------
##
## includeGalleryNav
##		rcontext.put("galleryHasAccessibilityURL", Boolean.valueOf((accessibilityURL != null && accessibilityURL != "")));
##		rcontext.put("galleryAccessibilityURL", accessibilityURL);
##		rcontext.put("gallaryLoggedIn", Boolean.valueOf(loggedIn));
##
##------------------------------------------------------------------------------------------
#macro( includeGalleryNav  )
<!-- start includeGalleryNav -->
<div id="portalOuterContainer">
	<div id="portalContainer">
		<div id="skipNav">
#if ($galleryHasAccessibilityURL)
			<a href="$galleryAccessibilityURL" class="skip" title="${rloader.sit_accessibility}" accesskey="0">${rloader.sit_accessibility}</a>
#end
			<a href="#tocontent"  class="skip" title="${rloader.sit_jumpcontent}" accesskey="c">${rloader.sit_jumpcontent}</a>
			<a href="#totoolmenu"  class="skip" title="${rloader.sit_jumptools}" accesskey="l">${rloader.sit_jumptools}</a>
			<a href="#sitetabs" class="skip" title="${rloader.sit_jumpworksite}" accesskey="w">${rloader.sit_jumpworksite}</a>
		</div>
#if (${gallaryLoggedIn})
		<div id="headerMax">
#includeTabs()
		</div>
#else
		<div id="headerMin">
#includeGalleryLogin()
			<div class="divColor" id="tabBottom"><br />
			</div>
		</div>
#end
#includePage()
	</div>
</div>
<!-- end includeGalleryNav -->
#end
##------------------------------------------------------------------------------------------
##
## includeGalleryLogin
##------------------------------------------------------------------------------------------
#macro( includeGalleryLogin  )
<!-- start includeGalleryLogin -->
<div class="siteNavBlock">	
	<table class="mast-head" cellpadding="0" cellspacing="0" border="0" width="100%" summary="Login Box" >
		<tr>
			<td class="right mast-head-r right">
#includeLogin()
			</td>
		</tr>
	</table>
</div>
<!-- end includeGalleryLogin -->
#end
##------------------------------------------------------------------------------------------
##
## includeSiteNav
##------------------------------------------------------------------------------------------
##        rcontext.put("siteNavHasAccessibilityURL",Boolean.valueOf((accessibilityURL != null && accessibilityURL != "")));
##        rcontext.put("siteNavAccessibilityURL",accessibilityURL);
##        
##        rcontext.put("siteNavLoggedIn",Boolean.valueOf(loggedIn));
#macro( includeSiteNav  )
<!-- start includeSiteNav -->
<div id="portalOuterContainer">
	<div id="portalContainer">
		<div id="skipNav">
#if ($siteNavHasAccessibilityURL)
			<a href="$siteNavAccessibilityURL" class="skip" title="${rloader.sit_accessibility}" accesskey="0">
				${rloader.sit_accessibility}
			</a>
#end

			<a href="#tocontent"  class="skip" title="${rloader.sit_jumpcontent}" accesskey="c">
			${rloader.sit_jumpcontent}
			</a>
			<a href="#totoolmenu"  class="skip" title="${rloader.sit_jumptools}" accesskey="l">
				${rloader.sit_jumptools}
			</a>
			<a href="#sitetabs" class="skip" title="${rloader.sit_jumpworksite}" accesskey="w">
				${rloader.sit_jumpworksite}
			</a>
		</div>
#if (${tabsSites})
		<div id="headerMax">
#includeLogo()
#includeTabs()
		</div>
#else
		<div id="headerMin">
#includeLogo()
			<div class="divColor" id="tabBottom">
				<br />
			</div>
		</div>
#end
#includePage()
	</div>
</div>
<!-- end includeSiteNav -->
#end



#macro( includeBottom )
<div id="footer">
	<div class="footerExtNav" align="center">
		|
#foreach ( $bn in $bottomNav )
		${bn}  | 
#end
	</div>
	<div id="footerInfo">
#foreach ( $pb in $bottomNavPoweredBy )
		<span class="skip">${rloader.site_newwindow}</span>	
		<a href="${pb.poweredByUrl}" target="_blank">
				<img border="0" src="${pb.poweredByImage}" alt="${pb.poweredByAltText}" /></a>
#end
	</div>
	<div class="sakaiCopyrightInfo">${bottomNavCopyright}<br />
	${bottomNavService} - ${bottomNavServiceVersion} - Sakai ${bottomNavSakaiVersion} - Server ${bottomNavServer}
	</div>
</div>
#end
